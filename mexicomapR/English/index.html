<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>mexicomapR vignette | En El Margen</title>
  <meta name="viewport" content="width=device-width">


  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/main.css">
  <!-- <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"> -->


  <!-- Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Open+Sans:400italic,600italic,400,600' rel='stylesheet' type='text/css'>
  
  
  <link rel="stylesheet" href="/css/post.css">
  

</head>
<body>
  <header style="background-image: url(/images/cover.jpg);">
  <div class="container post-container">
    <a href="/" class="home_button"></a>
    <div class="inner-container">
      <ul class="meta">
        <li>
        <p style="color:white">Publicado: 06 Jan 2016</p>
        </li>
        <li>
            <p style="color:white">Archivado en: </p>
        </li>
      </ul>      
    </div>
    <ul class="pagination">
      
      
    </ul>
  </div>
</header>

<article>
  <div class="container">
          <h1>mexicomapR vignette</h1>
          <br></br>
    <p><code>mexicomapR</code> is an R package designed to make the task of creating Mexican choropleth maps as easily as possible. Although downloading the original shapefiles and following some very well written tutorials like <a href="http://zevross.com/blog/2014/04/11/using-r-to-quickly-create-an-interactive-online-map-using-the-leafletr-package/">these</a> produce the same results, this package wraps the process into a simple function (<code>mxmap()</code>) that let’s you worry about the data, not the map.</p>

<p>To ilustrate the workings of the package, i’m going to create a few maps with some random data and a then using real data with the <a href="http://enelmargen.org/inegiR/">inegiR</a> package.</p>

<h2 id="installs">Installs</h2>
<p>Download the package (she’s a heavy one!) and dependencies…</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>devtools<span class="p">)</span>
install_github<span class="p">(</span><span class="s">&quot;eflores89/mexicomapR&quot;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>leaflet<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>sp<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>utils<span class="p">)</span></code></pre></div>

<h2 id="simple-example">Simple example</h2>

<p>To create a state level choropleth, we can see the geographic catalog in plain spanish by reading the data in the package (if your picky about grammar, read the <em>encoding</em> part of this vignette at the end).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">data<span class="p">(</span>states_catalog<span class="p">,</span> package <span class="o">=</span> <span class="s">&quot;mexicomapR&quot;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>states_catalog<span class="p">)</span>
<span class="c1">#  CVE_ENT              NOM_ENT id        ENT_INEGIR  ZONA_INEGIR</span>
<span class="c1">#0      01       Aguascalientes  0    Aguascalientes Centro_Norte</span>
<span class="c1">#1      02      Baja California  1    BajaCalifornia        Norte</span>
<span class="c1">#2      03  Baja California Sur  2 BajaCaliforniaSur        Norte</span>
<span class="c1">#3      04             Campeche  3          Campeche          Sur</span>
<span class="c1">#4      05 Coahuila de Zaragoza  4          Coahuila        Norte</span>
<span class="c1">#5      06               Colima  5            Colima Centro_Norte</span></code></pre></div>

<p>The important key take-away is this: the mapping function takes a data.frame as argument with two columns: “id” (which is the same “id” as <code>states_catalog</code>) and “value”, which contains the data.</p>

<p>With the catalog, we can merge or create our own data.frame. For this exercise, let’s make some random numbers:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">random_df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span><span class="s">&quot;id&quot;</span> <span class="o">=</span> states_catalog<span class="o">$</span>id<span class="p">,</span> 
                        <span class="s">&quot;value&quot;</span> <span class="o">=</span> runif<span class="p">(</span><span class="m">32</span><span class="p">,</span> min <span class="o">=</span> <span class="m">1</span><span class="p">,</span> max <span class="o">=</span> <span class="m">100</span><span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>random_df<span class="p">)</span>
<span class="c1">#  id    value</span>
<span class="c1">#1  0 63.60188</span>
<span class="c1">#2  1 96.57627</span>
<span class="c1">#3  2 65.97673</span>
<span class="c1">#4  3 73.14957</span>
<span class="c1">#5  4 38.59551</span>
<span class="c1">#6  5 49.73579</span></code></pre></div>

<p>And now, we create a map.</p>

<h2 id="map-types">Map types</h2>

<p>There are basically four possible types of maps:</p>

<ul>
  <li>
    <p><strong>Static maps:</strong> a ggplot2 choropleth map. The output is a ggplot2 object, so more layers such as themes can be added after. This map can be state or municipality (level-2).</p>
  </li>
  <li>
    <p><strong>Leaflet maps:</strong> a leaflet choropleth map. This is a <a href="https://rstudio.github.io/leaflet/">leaflet</a> (or htmlwidget) map and can be saved as such. So, just like the former type, more layers can be added. The added bonus with the leaflet maps is the interactivity: you can zoom and click. This map can also be state or municipality (level-2).</p>
  </li>
</ul>

<p>To create a static state map with our random data, we call the main function <code>mxmap()</code>, which serves only to call the function we need (in this case <code>mxmap_state_s()</code>):</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">map <span class="o">&lt;-</span> mxmap<span class="p">(</span>df <span class="o">=</span> random_df<span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;state&quot;</span><span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;static&quot;</span><span class="p">)</span>
<span class="c1"># Using mxmap_state_s</span>
<span class="c1"># Regions defined for each Polygons</span>

<span class="c1"># I want to add some themes and titles</span>
<span class="c1"># The theme is from:</span>
<span class="c1"># install_github(&quot;eflores89/eem&quot;)</span>

map <span class="o">+</span> 
theme_eem<span class="p">()</span> <span class="o">+</span> 
labs<span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;Choropleth map of random data&quot;</span><span class="p">)</span></code></pre></div>

<p>The result is this:</p>

<p><img src="" alt="Static mexican choropleth map created with mexicomapR" /></p>

<h2 id="integration-with-inegir-package">Integration with inegiR package</h2>

<h2 id="encoding">Encoding</h2>
<p>An issue worth mentioning is the encoding problems related to the municipality and state names in spanish.</p>

<p>Because these are not advisable if submitting to CRAN (see <a href="http://stackoverflow.com/questions/18837855/making-non-ascii-data-suitable-for-cran">here</a> and <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Data-in-packages">here</a>), my solution was to basically;</p>

<ul>
  <li>Omit the “name” column from the PolygonDataFrames.</li>
  <li>Make this (original) data available <a href="">here</a>.</li>
  <li>Make a name column in the <code>states_catalog</code> and <code>municipality_catalog</code> datasets that does <strong><em>not</em></strong> have special non-ASCII letters. (Nuevo León is now <em>Nuevo Leon</em>)</li>
</ul>

  </div>
</article>

</body>
</html>
