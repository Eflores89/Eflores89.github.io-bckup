<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>inegiR | En El Margen</title>
  <meta name="viewport" content="width=device-width">


  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/main.css">
  <!-- <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"> -->


  <!-- Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Open+Sans:400italic,600italic,400,600' rel='stylesheet' type='text/css'>
  
  
  <link rel="stylesheet" href="/css/post.css">
  

</head>
<body>
  <header style="background-image: url(/images/cover.jpg);">
  <div class="container post-container">
    <a href="/" class="home_button"></a>
    <div class="inner-container">
      <ul class="meta">
        <li>
        <p style="color:white">Publicado: 22 Oct 2015</p>
        </li>
        <li>
            <p style="color:white">Archivado en: </p>
        </li>
      </ul>      
    </div>
    <ul class="pagination">
      
      
    </ul>
  </div>
</header>
<article>
    <div id="topbar">
      
    </div>
  <div class="container">
    <h1>inegiR</h1>
    <h1 id="resumen">Resumen</h1>

<p>inegiR es un paquete diseñado para interactuar con el API del INEGI (Agencia estadísitica de México). El API en cuestión permite bajar datos en JSON o XML, por lo que este proyecto es basicamente un wrapper de los paquetes jsonlite y XML, con algunas transformaciones usando plyr y zoo.</p>

<p>Este paquete usa dos funciones principales:</p>

<ul>
  <li><code>serie_inegi()</code> - Para series de datos.</li>
  <li><code>denue_inegi()</code> - Para datos en el DENUE.</li>
</ul>

<p>Las demás funciones funcionan como <em>wrappers</em> para facilitar algunas tareas comunes, como obtener la tasa de inflación anual (<code>inflacion_general()</code>) o calcular la tasa de cambio año contra año (<code>YoY()</code>).</p>

<h2 id="ejemplo-1-bajar-serie-de-datos">Ejemplo 1: bajar serie de datos</h2>

<hr />

<h3 id="instalar">Instalar</h3>

<p>La version CRAN (desde Nov-2015):</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span>inegiR<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>inegiR<span class="p">)</span></code></pre></div>

<p>Usando devtools también se puede obtener la versión de desarrollo más nueva:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#install.packages(&quot;devtools&quot;)</span>
<span class="kn">library</span><span class="p">(</span>devtools<span class="p">)</span>
install_github<span class="p">(</span><span class="s">&quot;Eflores89/inegiR&quot;</span><span class="p">)</span>
  <span class="c1">#dependiencies: zoo, XML, plyr, jsonlite</span>
<span class="kn">library</span><span class="p">(</span>inegiR<span class="p">)</span></code></pre></div>

<h3 id="bajar-datos">Bajar datos</h3>

<p>A grandes razgos, hay dos maneras de bajar la serie: una forma general y una más corta (si existe una función directa para esa serie).</p>

<p>En el primer caso, el usuario pasa un URL a la función. En el <a href="http://www.inegi.org.mx/desarrolladores/indicadores/apiindicadores.aspx">sitio de desarrolladores</a> del INEGI, se pueden consultar estos mismos. También es necesario inscribirte con tu correo, para obtener un token con el cual acceder al servicio.</p>

<p>Guardemos nuestro token imaginario:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">token <span class="o">&lt;-</span> <span class="s">&quot;abc123&quot;</span></code></pre></div>

<p>Obtengamos la tasa de inflación anual. En el caso mexicano, esto es decir la tasa de cambio de la serie INPC.</p>

<p>Este es el URL correspondiente para el INPC:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">urlINPC <span class="o">&lt;-</span> <span class="s">&quot;http://www3.inegi.org.mx/sistemas/api/indicadores/v1//Indicador/216064/00000/es/false/xml/&quot;</span></code></pre></div>

<p>Las URL’s en formato JSON también es aceptado en el paquete, solo evita poner el “?callback” que viene en algunos casos en el sitio oficial.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">urlINPC2 <span class="o">&lt;-</span> <span class="s">&quot;http://www3.inegi.org.mx/sistemas/api/indicadores/v1//Indicador/216064/00000/es/false/json/&quot;</span></code></pre></div>

<p>Obtengamos los datos.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">INPC <span class="o">&lt;-</span> serie_inegi<span class="p">(</span>urlINPC<span class="p">,</span> token<span class="p">)</span>

<span class="c1"># veamos</span>
<span class="kp">tail</span><span class="p">(</span>INPC<span class="p">)</span>
<span class="c1"># Fechas         Valores</span>
<span class="c1"># 2014-12-01   116.05900000</span>
<span class="c1"># 2015-01-01   115.95400000</span>
<span class="c1"># 2015-02-01   116.17400000</span>
<span class="c1"># 2015-03-01   116.64700000</span>
<span class="c1"># 2015-04-01   116.34500000</span>
<span class="c1"># 2015-05-01   115.76400000</span></code></pre></div>

<p>El parametro de “metadata” es opcional y nos permite también bajar los datos de la serie tales como unidades, última actualización, etc.</p>

<p>Cuando este parametro está como “TRUE”, la información se escribe como una lista con dos elementos: en el primero el metadata y en el segundo los datos.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">INPC_Metadata <span class="o">&lt;-</span> serie_inegi<span class="p">(</span>urlINPC<span class="p">,</span> token<span class="p">,</span> metadata <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="kp">class</span><span class="p">(</span>INPC_Metadata<span class="p">)</span>
<span class="c1"># [1] &quot;list&quot;</span></code></pre></div>

<p>Para obtener estos datos, usar como si fuese lista:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># date of last update</span>
INPC_Metadata<span class="o">$</span>MetaData<span class="o">$</span>UltimaActualizacion
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;2015/06/09&quot;</span></code></pre></div>

<p>Ya que tenemos la serie, tenemos que calcular la tasa de cambio, que es la inflación. Para esto, usamos la función YoY(), que nos permite calcular tasas de cambio por periodos de comparación. El parametro de lapso indica cada cuantos periodos hacer la comparación (para una serie mensual una tasa anual es = 12).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">Inflacion <span class="o">&lt;-</span> YoY<span class="p">(</span>INPC<span class="o">$</span>Valores<span class="p">,</span> 
                 lapso <span class="o">=</span> <span class="m">12</span><span class="p">,</span> 
                 decimal<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># para ponerlo en un data frame</span>
Inflacion_df <span class="o">&lt;-</span> <span class="kp">cbind.data.frame</span><span class="p">(</span>Fechas <span class="o">=</span> INPC<span class="o">$</span>Fechas<span class="p">,</span> 
                                 Inflacion <span class="o">=</span> Inflacion<span class="p">)</span>

<span class="kp">tail</span><span class="p">(</span>Inflacion_df<span class="p">)</span>
<span class="c1"># Fechas        Inflacion</span>
<span class="c1"># 2014-12-01    4.081322</span>
<span class="c1"># 2015-01-01    3.065642</span>
<span class="c1"># 2015-02-01    3.000266</span>
<span class="c1"># 2015-03-01    3.137075</span>
<span class="c1"># 2015-04-01    3.062327</span>
<span class="c1"># 2015-05-01    2.876643</span></code></pre></div>

<p>Este método funciona para cualquier URL, pero para algunos indicadores más comunes, el paquete ya tiene algunos atajos incluidos.</p>

<p>Obtengamos la misma serie de inflación usando una de estas funciones:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">Inflation_rapido <span class="o">&lt;-</span> inflacion_general<span class="p">(</span>token<span class="p">)</span>
<span class="kp">tail</span><span class="p">(</span>Inflation_rapido<span class="p">)</span>
<span class="c1"># Fechas        Inflacion</span>
<span class="c1"># 2014-12-01    4.081322</span>
<span class="c1"># 2015-01-01    3.065642</span>
<span class="c1"># 2015-02-01    3.000266</span>
<span class="c1"># 2015-03-01    3.137075</span>
<span class="c1"># 2015-04-01    3.062327</span>
<span class="c1"># 2015-05-01    2.876643</span></code></pre></div>

<h2 id="ejemplo-2-bajando-datos-del-denue">Ejemplo 2: bajando datos del DENUE</h2>

<p>El DENUE es un directorio de negocios en México y es accesible en tiempo real mediante <a href="http://www.inegi.org.mx/desarrolladores/denue/apidenue.aspx">otro API del INEGI</a>.</p>

<p>En ese mismo sitio, debemos obtener otro token para usar este servicio. Lo guardamos también en un objeto:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">token_denue <span class="o">&lt;-</span> <span class="s">&quot;abcdef1234&quot;</span></code></pre></div>

<p>Para obtener una lista de negocios en un cierto radio alrededor de unas coordenadas, usamos la función primitiva. Por ejemplo, para la macroplaza en Monterrey, guardamos los datos de coordenadas:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">latitud_macro<span class="o">&lt;-</span><span class="s">&quot;25.669194&quot;</span>
longitud_macro<span class="o">&lt;-</span><span class="s">&quot;-100.309901&quot;</span></code></pre></div>

<p>Ahora, obtenemos un data.frame con una lista de negocios a 250 metros de esas coordenadas:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">NegociosMacro <span class="o">&lt;-</span> denue_inegi<span class="p">(</span>latitud <span class="o">=</span> latitud_macro<span class="p">,</span> 
                             longitud <span class="o">=</span> longitud_macro<span class="p">,</span> 
                             token<span class="p">)</span></code></pre></div>

<p>Observemos primeras columnas y filas…</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">head</span><span class="p">(</span>NegociosMacro<span class="p">)[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span>
<span class="c1">#     id                                       Nombre</span>
<span class="c1"># 2918696                   ESTACIONAMIENTO GRAN PLAZA</span>
<span class="c1"># 2918698             TEATRO DE LA CIUDAD DE MONTERREY</span>
<span class="c1"># 2918723                           CONGRESO DE ESTADO</span>
<span class="c1"># 2918793               SECRETARIA DE SALUD DEL ESTADO</span>
<span class="c1"># 2974150                           BIBLIOTECA CENTRAL</span>
<span class="c1"># 2974215      SOTANO RECURSOS HUMANOS Y ADQUISICIONES</span></code></pre></div>

<p>Se puede especificar tanto la distancia como el tipo de negocio. Por ejemplo, en un radio a 1km y solamente los “Restaurantes”:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">RestaurantesMacro <span class="o">&lt;-</span> denue_inegi<span class="p">(</span>latitud <span class="o">=</span> latitud_macro<span class="p">,</span> 
                                 longitud <span class="o">=</span> longitud_macro<span class="p">,</span> 
                                 token<span class="p">,</span> 
                                 metros <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> 
                                 keyword <span class="o">=</span> <span class="s">&quot;Restaurante&quot;</span><span class="p">)</span></code></pre></div>

  </div>
</article>

</body>
</html>
